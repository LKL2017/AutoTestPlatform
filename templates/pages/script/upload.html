<!DOCTYPE html>
<html lang="en">
{% load staticfiles %}
{% load customTags %}
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Test Automation Home</title>


    <!-- Bootstrap Core CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet"/>
    <!-- MetisMenu CSS -->
    <link href="{% static 'css/metisMenu.min.css' %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/custom.css' %}" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="{% static 'font-awesome/css/font-awesome.min.css' %}" rel="stylesheet" type="text/css">


    {#    <link href="{% static 'js/prettyCode/prettify.css' %}" rel="stylesheet" type="text/css">#}
    <style type="text/css">
        .textarea {
            resize: none;
            overflow-y: hidden;
        }

        .panel.noborder {
            border: none;
            box-shadow: none;
        }

        .panel.noborder > .panel-heading {
            border: 1px solid #dddddd;
            border-radius: 0;
        }

        table.borderless td, table.borderless th {
            border: none !important;
        }
    </style>
</head>

<body>

<div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Test Automation</a>
        </div>
        <!-- /.navbar-header -->

        <ul class="nav navbar-top-links navbar-right">
            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-tasks">
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 1</strong>
                                    <span class="pull-right text-muted">40% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                        <span class="sr-only">40% Complete (success)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 2</strong>
                                    <span class="pull-right text-muted">20% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                        <span class="sr-only">20% Complete</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 3</strong>
                                    <span class="pull-right text-muted">60% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                        <span class="sr-only">60% Complete (warning)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 4</strong>
                                    <span class="pull-right text-muted">80% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                        <span class="sr-only">80% Complete (danger)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Tasks</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
                <!-- /.dropdown-tasks -->
            </li>
            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-alerts">
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-comment fa-fw"></i> New Comment
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                <span class="pull-right text-muted small">12 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-envelope fa-fw"></i> Message Sent
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-tasks fa-fw"></i> New Task
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Alerts</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
                <!-- /.dropdown-alerts -->
            </li>
            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="#"><i class="fa fa-user fa-fw"></i> 用户信息</a>
                    </li>
                    <li><a href="#"><i class="fa fa-gear fa-fw"></i> 设置</a>
                    </li>
                    <li class="divider"></li>
                    <li><a href="{% url  "user:logout" %}"><i class="fa fa-sign-out fa-fw"></i> 注销</a>
                    </li>
                </ul>
                <!-- /.dropdown-user -->
            </li>
            <!-- /.dropdown -->
        </ul>
        <!-- /.navbar-top-links -->

        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li class="sidebar-search">
                        <div class="input-group custom-search-form">
                            <input type="text" class="form-control" placeholder="Search...">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                        <!-- /input-group -->
                    </li>
                    <li>
                        <a href="{% url "home" %}"><i class="fa fa-dashboard fa-fw"></i> 看板</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> 产品<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="{% url "product:info" %}">产品一览</a>
                            </li>
                            <li>
                                {#                                TODO 增加产品管理相关功能#}
                                <a href="#">产品管理</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>

                    <li>
                        <a href="{% url "testcase:list" %}"><i class="fa fa-edit fa-fw"></i> 测试用例</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> 脚本管理<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="{% url "script:upload" %}">上传脚本</a>
                            </li>
                            <li>
                                {#                                TODO 增加产品管理相关功能#}
                                <a href="#">脚本一览</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-wrench fa-fw"></i> 执行<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="pages/product/detail.html">Panels and Wells</a>
                            </li>
                            <li>
                                <a href="./pages/buttons.html">Buttons</a>
                            </li>
                            <li>
                                <a href="./pages/notifications.html">Notifications</a>
                            </li>
                            <li>
                                <a href="./pages/typography.html">Typography</a>
                            </li>
                            <li>
                                <a href="./pages/icons.html"> Icons</a>
                            </li>
                            <li>
                                <a href="./pages/grid.html">Grid</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-sitemap fa-fw"></i> Multi-Level Dropdown<span
                                class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="#">Second Level Item</a>
                            </li>
                            <li>
                                <a href="#">Second Level Item</a>
                            </li>
                            <li>
                                <a href="#">Third Level <span class="fa arrow"></span></a>
                                <ul class="nav nav-third-level">
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                </ul>
                                <!-- /.nav-third-level -->
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-files-o fa-fw"></i> Sample Pages<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="./pages/blank.html">Blank Page</a>
                            </li>
                            <li>
                                <a href="login.html">Login Page</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                </ul>
            </div>
            <!-- /.sidebar-collapse -->
        </div>
        <!-- /.navbar-static-side -->
    </nav>
    <div id="wrapper">


        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">上传脚本</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <div class="alert alert-info alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                请选择相应的脚本类型，并从右侧的测试用例列表中，选择对应的测试用例！
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            上传脚本
                        </div>
                        <div class="panel-body">
                            <table class="table">
                                <tr>
                                    <td>用户名：</td>
                                    <td>renzy</td>
                                </tr>
                                <tr>
                                    <td>脚本类型：</td>
                                    <td>
                                        <select class="form-control">
                                            <option>WEB测试</option>
                                            <option>API测试</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>关联测试用例：</td>
                                    <td>第一个测试用例</td>
                                </tr>

                            </table>
                        </div>
                        <div class="panel-footer">
                            Panel Footer
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-4 -->
                <div class="col-lg-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            测试用例
                        </div>
                        <div class="panel-body">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <span class="fa fa-list"></span>
                                    用例列表
                                </div>
                                <!-- .panel-heading -->
                                <div class="panel-body">
                                    <div class="panel-group" id="listPanel">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#listPanel" href="#dftGroup">默认分组</a>
                                                </h4>
                                            </div>
                                            <div id="dftGroup" class="panel-collapse collapse in">
                                                <div class="panel-body">
                                                    <div class="list-group">
                                                        <a class="list-group-item active">测试用例1</a>
                                                        <a class="list-group-item">测试用例2</a>
                                                        <a class="list-group-item">测试用例3</a>
                                                        <a class="list-group-item">测试用例4</a>
                                                        <a class="list-group-item">测试用例5</a>
                                                        <a class="list-group-item">测试用例6</a>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#listPanel"
                                                       href="#loginGroup">登录</a>
                                                </h4>
                                            </div>
                                            <div id="loginGroup" class="panel-collapse collapse">
                                                <div class="panel-body">
                                                    <div class="list-group">
                                                        <a class="list-group-item active">测试用例1</a>
                                                        <a class="list-group-item">测试用例2</a>
                                                        <a class="list-group-item">测试用例3</a>
                                                        <a class="list-group-item">测试用例4</a>
                                                        <a class="list-group-item">测试用例5</a>
                                                        <a class="list-group-item">测试用例6</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#listPanel"
                                                       href="#collapseThree">核心功能</a>
                                                </h4>
                                            </div>
                                            <div id="collapseThree" class="panel-collapse collapse">
                                                <div class="panel-body">
                                                    <div class="list-group">
                                                        <a class="list-group-item active">测试用例1</a>
                                                        <a class="list-group-item">测试用例2</a>
                                                        <a class="list-group-item">测试用例3</a>
                                                        <a class="list-group-item">测试用例4</a>
                                                        <a class="list-group-item">测试用例5</a>
                                                        <a class="list-group-item">测试用例6</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                    </div>
                                    <!-- .panel-body -->
                                </div>
                                <!-- /.panel -->
                            </div>
                            <!-- /.col-lg-8 -->
                        </div>
                        <div class="panel-footer">
                            Panel Footer
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-4 -->
            </div>
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->


</div>
<!-- /#wrapper -->

<!-- jQuery -->
<script src="{% static 'js/jquery.js' %}"></script>

<!-- Bootstrap Core JavaScript -->
<script src="{% static 'js/bootstrap.min.js' %}"></script>

<!-- Metis Menu Plugin JavaScript -->
<script src="{% static 'js/metisMenu.min.js' %}"></script>

<!-- Custom Theme JavaScript -->
<script src="{% static 'js/custom.min.js' %}"></script>

{#<script src="{% static 'js/prettyCode/run_prettify.js' %}"></script>#}

<script src="{% static 'js/jsrender.min.js' %}"></script>

<script id="rowTemplate" type="text/x-jsrender">

<tr>
<td>
<%:step%>
</td>
<td>
<%:expect%>
</td>
</tr>


</script>

<script id="preTemplate" type="text/x-jsrender">

<tr>
<td>
<%:pre%>
</td>
</tr>


</script>


<script type="text/javascript">

    function submitData(id) {
        $.ajax({
                url: "{% url 'testcase:detail' %}",
                type: "get",
                data: {'id': id, csrfmiddlewaretoken: '{{ csrf_token }}'},
                dataType: "json",
                success: function (data) {
                    handleData(data)
                }
            }
        )
    }

    function handleData(data) {
        {#        用于处理返回的测试用例数据#}
        {#        修改测试用例的相关信息页面#}
        let caseInfo = data.caseData;
        let caseDetail = data.caseDetail;
        {#                修改测试用例的创建信息#}
        $("#createUser").html(caseInfo.create_user);
        $("#createTime").html(caseInfo.create_time);
        $("#lastEditer").html(caseInfo.last_edit_user);
        $("#lastEditTime").html(caseInfo.last_edit_time);
        $("#btCaseId").html(caseInfo.id);
        $("#detailId").html(caseInfo.id);
        $("#lbTitle").html(caseInfo.title);
        $("#detailTitle").html(caseInfo.title);
        if (caseInfo.editable === true) {
            $("#btCanEdit").css("display", "block");
            $("#btCantEdit").css("display", "none");
        }
        else {
            $("#btCanEdit").css("display", "none");
            $("#btCantEdit").css("display", "block");
        }

        {# 修改测试用例的详细信息#}
        {# 修改前置条件#}
        let pres = caseDetail.pres;
        let table_pre = $("#tPre").children("tbody");
        table_pre.empty();
        let pre_template = $.templates("#preTemplate");
        let pres_list = [];
        for (let i = 0; i < pres.length; i++) {
            pres_list.push({"pre": pres[i]})
        }
        let pre_row = pre_template(pres_list);
        table_pre.html(pre_row);

        {#  修改步骤和期望#}

        let steps = caseDetail.steps;
        let expects = caseDetail.expects;
        let row_steps_expects = $("#tSteps").children("tbody");
        row_steps_expects.empty();
        let step_expects = [];
        for (let i = 0; i < steps.length; i++) {
            let step_expect = [];
            step_expect["step"] = steps[i];
            step_expect["expect"] = expects[i];
            step_expects.push(step_expect);
        }
        {#进行模板的渲染#}
        let rowTemplate = $.templates("#rowTemplate");
        let row = rowTemplate(step_expects);
        row_steps_expects.html(row);
    }

    $(document).ready(function () {
            $.views.settings.delimiters("<%", "%>");
            {#            $("#btPreEdit").click(function () {#}
            {#                editButtonClickEvent($(this));#}
            {#            });#}
            {#            $("#btStepEdit").click(function () {#}
            {#                editButtonClickEvent($(this));#}
            {#            });#}
            $("a.list-group-item:first").addClass("active");
            {#为左侧的导航列表添加点击事件#}
            $("a.list-group-item").click(function () {
                $("a.list-group-item").removeClass("active");
                $(this).addClass("active");
                {#                进行异步请求#}
                submitData($(this).attr("name"));
            });
            $("#btCanEdit").click(function () {
                window.location.href = '{% url "testcase:caseDetail" %}';
            });

        }
    )
</script>

</body>

</html>
