<!DOCTYPE html>
<html lang="en">
{% load staticfiles %}
{% load customTags %}
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Test Automation Home</title>


    <!-- Bootstrap Core CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet"/>
    <!-- MetisMenu CSS -->
    <link href="{% static 'css/metisMenu.min.css' %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/custom.css' %}" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="{% static 'font-awesome/css/font-awesome.min.css' %}" rel="stylesheet" type="text/css">

    {#    <link href="{% static 'js/prettyCode/prettify.css' %}" rel="stylesheet" type="text/css">#}
    <style type="text/css">
        .textarea {
            resize: none;
            overflow-y: hidden;
        }
    </style>
</head>

<body>

<div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Test Automation</a>
        </div>
        <!-- /.navbar-header -->

        <ul class="nav navbar-top-links navbar-right">
            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-tasks">
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 1</strong>
                                    <span class="pull-right text-muted">40% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                        <span class="sr-only">40% Complete (success)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 2</strong>
                                    <span class="pull-right text-muted">20% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                        <span class="sr-only">20% Complete</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 3</strong>
                                    <span class="pull-right text-muted">60% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                        <span class="sr-only">60% Complete (warning)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 4</strong>
                                    <span class="pull-right text-muted">80% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                        <span class="sr-only">80% Complete (danger)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Tasks</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
                <!-- /.dropdown-tasks -->
            </li>
            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-alerts">
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-comment fa-fw"></i> New Comment
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                <span class="pull-right text-muted small">12 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-envelope fa-fw"></i> Message Sent
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-tasks fa-fw"></i> New Task
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Alerts</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
                <!-- /.dropdown-alerts -->
            </li>
            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="#"><i class="fa fa-user fa-fw"></i> 用户信息</a>
                    </li>
                    <li><a href="#"><i class="fa fa-gear fa-fw"></i> 设置</a>
                    </li>
                    <li class="divider"></li>
                    <li><a href="{% url  "user:logout" %}"><i class="fa fa-sign-out fa-fw"></i> 注销</a>
                    </li>
                </ul>
                <!-- /.dropdown-user -->
            </li>
            <!-- /.dropdown -->
        </ul>
        <!-- /.navbar-top-links -->

        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li class="sidebar-search">
                        <div class="input-group custom-search-form">
                            <input type="text" class="form-control" placeholder="Search...">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                        <!-- /input-group -->
                    </li>
                    <li>
                        <a href="{% url "home" %}"><i class="fa fa-dashboard fa-fw"></i> 看板</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> 产品<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="{% url "product:info" %}">产品一览</a>
                            </li>
                            <li>
                                {#                                TODO 增加产品管理相关功能#}
                                <a href="#">产品管理</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                    <li>
                        <a href="{% url "product:info" %}"><i class="fa fa-table fa-fw"></i> 产品</a>
                    </li>
                    <li>
                        <a href="./pages/forms.html"><i class="fa fa-edit fa-fw"></i> 测试用例</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-wrench fa-fw"></i> 执行<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="pages/product/detail.html">Panels and Wells</a>
                            </li>
                            <li>
                                <a href="./pages/buttons.html">Buttons</a>
                            </li>
                            <li>
                                <a href="./pages/notifications.html">Notifications</a>
                            </li>
                            <li>
                                <a href="./pages/typography.html">Typography</a>
                            </li>
                            <li>
                                <a href="./pages/icons.html"> Icons</a>
                            </li>
                            <li>
                                <a href="./pages/grid.html">Grid</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-sitemap fa-fw"></i> Multi-Level Dropdown<span
                                class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="#">Second Level Item</a>
                            </li>
                            <li>
                                <a href="#">Second Level Item</a>
                            </li>
                            <li>
                                <a href="#">Third Level <span class="fa arrow"></span></a>
                                <ul class="nav nav-third-level">
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Item</a>
                                    </li>
                                </ul>
                                <!-- /.nav-third-level -->
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-files-o fa-fw"></i> Sample Pages<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="./pages/blank.html">Blank Page</a>
                            </li>
                            <li>
                                <a href="login.html">Login Page</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                </ul>
            </div>
            <!-- /.sidebar-collapse -->
        </div>
        <!-- /.navbar-static-side -->
    </nav>
    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">测试用例</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <span class="fa fa-list"></span>
                        用例列表
                    </div>
                    <!-- .panel-heading -->
                    <div class="panel-body">
                        <div class="panel-group" id="listPanel">
                            {#    生成左边的列表#}
                            {% for case_module,case_list in module_case_dict.items %}
                                {#  生成标题#}
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#listPanel"
                                               href="#group{{ case_module | timestamp }}">
                                                {{ case_module }}</a>
                                        </h4>
                                    </div>
                                    <div id="group{{ case_module | timestamp }}" class="panel-collapse collapse in">
                                        <div class="panel-body">
                                            <div class="list-group">
                                                {#  生成测试用例列表#}
                                                {% for case in case_list %}
                                                    <a class="list-group-item" href="#"
                                                       name="{{ case.id }}">{{ case.title }}</a>
                                                {% empty %}
                                                    <p>该模块下无测试用例</p>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            {#    完成生成左边的侧边栏#}

                        </div>

                    </div>
                    <!-- .panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-8 -->
            <div class="col-lg-8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <span class="fa fa-folder-open"></span>
                        用例信息
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#home" data-toggle="tab">用例信息</a>
                            </li>
                            <li>
                                <a href="#profile" data-toggle="tab">历史记录</a>
                            </li>
                            <li>
                                <a href="#messages" data-toggle="tab">脚本信息</a>
                            </li>
                        </ul>

                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div class="tab-pane fade" id="profile">
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-lg-12" id="divProductInfo">
                                        <div class="panel panel-success">
                                            <div class="panel-heading">
                                                <button class="btn btn-default btn-xs disabled"
                                                        id="btCaseId">{{ first_case.id }}</button>
                                                <label class="header" id="lbTitle"
                                                       style="margin-left: 10px;">{{ first_case.title }}</label>
                                            </div>
                                            <div class="panel-body">
                                                <div id="statusAndDesc" class="row col-lg-12">
                                                    <div class="row">
                                                        <div class="col-lg-1 text-left">
                                                            {% if first_case.editable %}
                                                                <button class="btn btn-success btn-xs disabled"
                                                                        id="btCanEdit">可编辑
                                                                </button>
                                                            {% else %}
                                                                <button class="btn btn-danger btn-xs disabled"
                                                                        id="btCantEdit">已锁定
                                                                </button>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row col-lg-12 text-left">
                                                    <hr/>
                                                    <div class="col-lg-12 text-left">
                                                        <label class="header">基本信息</label>
                                                    </div>
                                                    <div class="row col-lg-8 text-left">
                                                        <table class="table" style="margin-left: 30px;margin-top: 30px">
                                                            <tr>
                                                                <td class="col-lg-3">
																						<span class="fa fa-user"
                                                                                              style="margin-left: 30px;"
                                                                                        >&nbsp;&nbsp;由谁创建
																						</span>
                                                                </td>
                                                                <td class="col-lg-5" id="createUser">
                                                                    {{ first_case.create_user }}
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
																						<span class="fa fa-calendar-times-o"
                                                                                              style="margin-left: 30px;"
                                                                                        >&nbsp;&nbsp;创建时间
																						</span>
                                                                </td>
                                                                <td id="createTime">
                                                                    {{ first_case.create_time }}
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
																						<span class="fa fa-user"
                                                                                              style="margin-left: 30px;">&nbsp;&nbsp;最后编辑者
																						</span>
                                                                </td>
                                                                <td id="lastEditer">{{ first_case.last_edit_user }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
																						<span class="fa fa-calendar-times-o"
                                                                                              style="margin-left: 30px;">&nbsp;&nbsp;编辑时间
																						</span>
                                                                </td>
                                                                <td id="lastEditTime">{{ first_case.last_edit_time }}</td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="messages">
                                <div class="row">
                                    <div class="row" style="margin-top: 10px;">
                                        <div class="col-lg-12" id="divProductInfo">
                                            <div class="panel panel-success">
                                                <div class="panel-heading">
                                                    <button class="btn btn-default btn-xs disabled">ID</button>
                                                    <label class="header" style="margin-left: 10px;">脚本1</label>
                                                </div>
                                                <div class="panel-body">
																	<pre class="prettyprint lang-python">
			or product in products:
            product_name = product.name
            product_create_time = product.createTime
            product_create_user = product.createUser
            product_incharge_user = product.inChargeUser
            product_status = product.status
            product_data = ProductData(product.id, name=product_name, create_user=user_dict.get(product_create_user),
                                       incharge_user=user_dict.get(product_incharge_user),
                                       create_time=str(product_create_time),
                                       status=status_dict.get(product_status), manager=product.manager,
                                       desc=product.desc)
            data_list.append(product_data)
        else:
            return render(request, "pages/product/productList.html", {"products": data_list})
																	</pre>
                                                </div>
                                                <div class="panel-footer">
                                                    End
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade in active" id="home">
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-lg-12">
                                        <div class="panel panel-success">
                                            <div class="panel-heading">
                                                <button class="btn btn-default btn-xs disabled">{{ first_case.id }}</button>
                                                <label class="header"
                                                       style="margin-left: 10px;">{{ first_case.title }}</label>
                                            </div>
                                            <div class="panel-body">
                                                <div class="row">
                                                    <div class="panel-group" id="casePanel">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">
                                                                <div class="row">
                                                                    <div class="col-lg-4">
                                                                        <a class="panel-title btn btn-default btn-outline"
                                                                           style="border: none;" data-toggle="collapse"
                                                                           data-parent="#casePanel"
                                                                           href="#preCondition">前置条件</a>
                                                                    </div>
                                                                    <div class="col-lg-8 text-right">
                                                                        <button class="btn btn-danger text-right btn-outline"
                                                                                id="btPreEdit" value="编辑">编辑
                                                                        </button>
                                                                    </div>


                                                                </div>
                                                            </div>
                                                            <div id="preCondition" class="panel-collapse collapse in">
                                                                <div class="panel-body">
                                                                    {% for pre in first_case_detail.pres %}
                                                                        <textarea
                                                                                class="form-control  textarea "
                                                                                style="margin-top: 10px"
                                                                                rows="1"
                                                                                disabled="disabled">{{ pre }}</textarea>
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">
                                                                <div class="row">
                                                                    <div class="col-lg-4">
                                                                        <a class="panel-title btn btn-default btn-outline"
                                                                           style="border: none;" data-toggle="collapse"
                                                                           data-parent="#casePanel"
                                                                           href="#steps">测试步骤</a>
                                                                    </div>
                                                                    <div class="col-lg-8 text-right">
                                                                        <button class="btn btn-danger text-right btn-outline"
                                                                                id="btStepEdit" value="编辑"
                                                                        > 编辑
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="steps" class="panel-collapse collapse">
                                                                <div class="panel-body">
                                                                    <table class="table">
                                                                        <thead>
                                                                        <tr>
                                                                            <th class="col-lg-6">测试步骤
                                                                            </th>
                                                                            <th class="col-lg-6">期望结果
                                                                            </th>
                                                                        </tr>
                                                                        </thead>

                                                                        {% for i in first_case_detail.steps|times %}
                                                                            <tr>
                                                                                <td>
                                                                                    <textarea
                                                                                            class="form-control textarea"
                                                                                            rows="1"
                                                                                            disabled="disabled">{{ first_case_detail.steps|item:i }}</textarea>
                                                                                </td>
                                                                                <td>
                                                                                    <textarea
                                                                                            class="form-control textarea"
                                                                                            rows="1"
                                                                                            disabled="disabled">{{ first_case_detail.steps|item:i }}</textarea>
                                                                                </td>
                                                                            </tr>
                                                                        {% endfor %}
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-6 -->
            </div>
        </div>
    </div>
</div>
<!-- /#wrapper -->

<!-- jQuery -->
<script src="{% static 'js/jquery.js' %}"></script>

<!-- Bootstrap Core JavaScript -->
<script src="{% static 'js/bootstrap.min.js' %}"></script>

<!-- Metis Menu Plugin JavaScript -->
<script src="{% static 'js/metisMenu.min.js' %}"></script>

<!-- Custom Theme JavaScript -->
<script src="{% static 'js/custom.min.js' %}"></script>

{#<script src="{% static 'js/prettyCode/run_prettify.js' %}"></script>#}

<script type="text/javascript">

    function editButtonClickEvent(element) {
        {#			    为span按钮添加点击事件，具体的功能为当其为点击编辑时，切换input的可输入状态为可输入#}
        {#                当其为OK时，切换input的状态为不可输入，同时发送请求，修改测试用例#}
        var status = element.html().trim();
        var btID = element.attr("id").trim();
        console.log(status, btID);
        if (status === "编辑") {
            console.log("执行到这里");
            if (btID === "btPreEdit") {
                $("div#preCondition textarea").removeAttr("disabled");
            }
            else if (btID === "btStepEdit") {
                $("div#steps textarea").removeAttr("disabled");
            }

            element.html("OK");
            element.removeClass("btn-danger");
            element.addClass("btn-success");
        } else if (status === "OK") {
            if (btID === "btPreEdit") {
                $("div#preCondition textarea").attr("disabled", "disabled");
            }
            else if (btID === "btStepEdit") {
                $("div#steps textarea").attr("disabled", "disabled");
            }
            element.html("编辑");
            element.removeClass("btn-success");
            element.addClass("btn-danger");
        }
    }

    function submitData(id) {
        $.ajax({
                url: "{% url 'testcase:detail' %}",
                type: "get",
                data: {'id': id, csrfmiddlewaretoken: '{{ csrf_token }}'},
                dataType: "json",
                success: function (data) {

                }
            }
        )
    }

    function handleData(data) {
        {#        用于处理返回的测试用例数据#}
        {#        修改测试用例的相关信息页面#}
        var caseInfo = data.caseData;
        var caseDetail = data.caseDetail;
        {#                修改测试用例的创建信息#}
        $("#createUser").html(caseInfo.create_user);
        $("#createTime").html(caseInfo.create_time);
        $("#lastEditer").html(caseInfo.last_edit_user);
        $("#lastEditTime").html(caseInfo.last_edit_time);
        $("#btCaseId").html(caseInfo.id);
        $("#lbTitle").html(caseInfo.title);
        if (caseInfo.caseInfo === true) {
            $("#btCanEdit").css("display", "block");
            $("#btCantEdit").css("display", "none");
        }
        else {
            $("#btCanEdit").css("display", "none");
            $("#btCantEdit").css("display", "block");
        }

        {# 修改测试用例的详细信息#}
        {# 修改前置条件#}
        var pres = caseDetail.pres;
        div_precondition = $("#preCondition").children(":first");
        div_precondition.empty();
        for (var i = 0; i < pres.length; i++) {
            var $text = $('<textarea class="form-control  textarea" style="margin-top: 10px" rows="1" disabled="disabled">' + pres[i] + '</textarea>');
            div_precondition.append($text);
        }
        {#  修改步骤和期望#}


    }


    $(document).ready(function () {
            $("#btPreEdit").click(function () {
                editButtonClickEvent($(this));
            });
            $("#btStepEdit").click(function () {
                editButtonClickEvent($(this));
            });
            $("a.list-group-item:first").addClass("active");
            {#为左侧的导航列表添加点击事件#}
            $("a.list-group-item").click(function () {
                $("a.list-group-item").removeClass("active");
                $(this).addClass("active");
                {#                进行异步请求#}
                submitData($(this).attr("name"));


            });
        }
    )


</script>

</body>

</html>
